{% extends 'layout/base.html' %}
{% load static %}

{% block title %}Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯ - {{ page_title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    
    <!-- Messages -->
    {% if messages %}
    <div class="row mb-4">
        <div class="col-12">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                <i class="bi {% if message.tags == 'success' %}bi-check-circle text-success{% elif message.tags == 'error' or message.tags == 'danger' %}bi-exclamation-triangle text-danger{% elif message.tags == 'warning' %}bi-exclamation-triangle text-warning{% else %}bi-info-circle text-info{% endif %} me-2"></i>
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <nav aria-label="breadcrumb" class="d-none d-md-block">
                <ol class="breadcrumb breadcrumb-light">
                    <li class="breadcrumb-item">
                        <a href="{% url 'sooratvaziat:project_list' %}">
                            <i class="bi bi-buildings me-1"></i>Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§
                        </a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                        Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯
                    </li>
                </ol>
            </nav>
            <h2 class="mb-1">
                <i class="bi bi-plus-circle text-success me-2"></i>
                Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯
            </h2>
            <p class="text-muted mb-0">
                <small>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ù†ÛŒØ¯</small>
            </p>
        </div>
        
        <div class="d-flex gap-2">
            <a href="{% url 'sooratvaziat:project_list' %}" 
               class="btn btn-outline-secondary">
                <i class="bi bi-arrow-right me-2"></i>Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª
            </a>
            <button type="button" class="btn btn-outline-danger" onclick="resetForm()">
                <i class="bi bi-arrow-clockwise me-2"></i>Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
            </button>
        </div>
    </div>

    <!-- ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡ -->
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card border-0 shadow-lg">
                <div class="card-header bg-secondary border-0">
                    <h5 class="card-title mb-0 text-light">
                        <i class="bi bi-card-checklist text-white me-2"></i>
                        Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡
                    </h5>
                </div>
                
                <div class="card-body p-4">
                    <form method="POST" id="projectCreateForm" enctype="multipart/form-data" novalidate>
                        {% csrf_token %}
                        
                        <!-- Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ú©Ù„ÛŒ -->
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                {{ form.non_field_errors }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endif %}
                        
                        <div class="row g-4">
                            <!-- Ú©Ø§Ø±Ø¨Ø± (Ù…Ø®ÙÛŒ) -->
                            <div style="display:none;">{{ form.user }}</div>
                            
                            
                            <!-- Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„: Ù†Ø§Ù… Ùˆ Ú©Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡ -->
                            <div class="col-md-8">
                                <div class="form-floating">
                                    <input type="text" 
                                           class="form-control {% if form.project_name.errors %}is-invalid{% endif %}"
                                           id="{{ form.project_name.id_for_label }}"
                                           name="{{ form.project_name.name }}"
                                           placeholder="Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡"
                                           value="{{ form.project_name.value|default:'' }}"
                                           maxlength="255"
                                           required>
                                    <label for="{{ form.project_name.id_for_label }}">
                                        {{ form.project_name.label }} <span class="text-danger">*</span>
                                    </label>
                                    {% if form.project_name.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.project_name.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-text">Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ù¾Ø±ÙˆÚ˜Ù‡ (Ù…Ø«Ø§Ù„: Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ø­Ø¯Ø§Ø« Ù¾Ù„ ÙÙ„Ø²ÛŒ)</div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input type="text" 
                                           class="form-control {% if form.project_code.errors %}is-invalid{% endif %}"
                                           id="{{ form.project_code.id_for_label }}"
                                           name="{{ form.project_code.name }}"
                                           placeholder="Ú©Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡"
                                           value="{{ form.project_code.value|default:'' }}"
                                           maxlength="50"
                                           autocomplete="off"
                                           required>
                                    <label for="{{ form.project_code.id_for_label }}">
                                        {{ form.project_code.label }} <span class="text-danger">*</span>
                                    </label>
                                    {% if form.project_code.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.project_code.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-text">Ù…Ø«Ø§Ù„: P-1403-001</div>
                            </div>
                            
                            <!-- Ø±Ø¯ÛŒÙ Ø¯ÙˆÙ…: Ø³Ø§Ù„ Ø§Ø¬Ø±Ø§ Ùˆ ØªØ§Ø±ÛŒØ® Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ -->
                            <div class="col-md-6">
                                <label for="{{ form.execution_year.id_for_label }}" class="form-label fw-semibold">
                                    {{ form.execution_year.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.execution_year }}
                                {% if form.execution_year.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.execution_year.errors.0 }}
                                    </div>
                                {% endif %}
                                <div class="form-text">Ø³Ø§Ù„ Ø§Ø¬Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØµÙˆØ±Øª ÙˆØ¶Ø¹ÛŒØª</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="{{ form.contract_date.id_for_label }}" class="form-label fw-semibold">
                                    {{ form.contract_date.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.contract_date }}
                                {% if form.contract_date.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.contract_date.errors.0 }}
                                    </div>
                                {% endif %}
                                <div class="form-text">ÙØ±Ù…Øª: 1403/06/15</div>
                            </div>
                            
                            <!-- Ø±Ø¯ÛŒÙ Ø³ÙˆÙ…: Ú©Ø§Ø±ÙØ±Ù…Ø§ Ùˆ Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø± -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" 
                                           class="form-control {% if form.employer.errors %}is-invalid{% endif %}"
                                           id="{{ form.employer.id_for_label }}"
                                           name="{{ form.employer.name }}"
                                           placeholder="Ú©Ø§Ø±ÙØ±Ù…Ø§"
                                           value="{{ form.employer.value|default:'' }}"
                                           maxlength="255"
                                           required>
                                    <label for="{{ form.employer.id_for_label }}">
                                        {{ form.employer.label }} <span class="text-danger">*</span>
                                    </label>
                                    {% if form.employer.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.employer.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-text">Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ú©Ø§Ø±ÙØ±Ù…Ø§ (Ù…Ø«Ø§Ù„: Ø´Ù‡Ø±Ø¯Ø§Ø±ÛŒ ØªÙ‡Ø±Ø§Ù†)</div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" 
                                           class="form-control {% if form.contractor.errors %}is-invalid{% endif %}"
                                           id="{{ form.contractor.id_for_label }}"
                                           name="{{ form.contractor.name }}"
                                           placeholder="Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø±"
                                           value="{{ form.contractor.value|default:'' }}"
                                           maxlength="255"
                                           required>
                                    <label for="{{ form.contractor.id_for_label }}">
                                        {{ form.contractor.label }} <span class="text-danger">*</span>
                                    </label>
                                    {% if form.contractor.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.contractor.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-text">Ù†Ø§Ù… Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø± (Ù…Ø«Ø§Ù„: Ø´Ø±Ú©Øª Ø¹Ù…Ø±Ø§Ù† Ø¢ØªÛŒ)</div>
                            </div>
                            
                            <!-- Ø±Ø¯ÛŒÙ Ú†Ù‡Ø§Ø±Ù…: Ù…Ø´Ø§ÙˆØ± Ùˆ Ù†Ø§Ø¸Ø± -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" 
                                           class="form-control {% if form.consultant.errors %}is-invalid{% endif %}"
                                           id="{{ form.consultant.id_for_label }}"
                                           name="{{ form.consultant.name }}"
                                           placeholder="Ù…Ø´Ø§ÙˆØ±"
                                           value="{{ form.consultant.value|default:'' }}"
                                           maxlength="255">
                                    <label for="{{ form.consultant.id_for_label }}">
                                        {{ form.consultant.label }}
                                    </label>
                                    {% if form.consultant.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.consultant.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-text">Ù†Ø§Ù… Ù…Ø¯ÛŒØ± Ø·Ø±Ø­ ÛŒØ§ Ù…Ø´Ø§ÙˆØ± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" 
                                           class="form-control {% if form.supervising_engineer.errors %}is-invalid{% endif %}"
                                           id="{{ form.supervising_engineer.id_for_label }}"
                                           name="{{ form.supervising_engineer.name }}"
                                           placeholder="Ù†Ø§Ø¸Ø±"
                                           value="{{ form.supervising_engineer.value|default:'' }}"
                                           maxlength="255">
                                    <label for="{{ form.supervising_engineer.id_for_label }}">
                                        {{ form.supervising_engineer.label }}
                                    </label>
                                    {% if form.supervising_engineer.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.supervising_engineer.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-text">Ù†Ø§Ù… Ù…Ù‡Ù†Ø¯Ø³ Ù†Ø§Ø¸Ø± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</div>
                            </div>
                            
                            <!-- Ø±Ø¯ÛŒÙ Ù¾Ù†Ø¬Ù…: Ù†ÙˆØ¹ Ù¾Ø±ÙˆÚ˜Ù‡ Ùˆ Ù…Ø¨Ù„Øº -->
                            <div class="col-md-6">
                                <label for="{{ form.project_type.id_for_label }}" class="form-label fw-semibold">
                                    {{ form.project_type.label }}
                                </label>
                                {{ form.project_type }}
                                {% if form.project_type.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.project_type.errors.0 }}
                                    </div>
                                {% endif %}
                                <div class="form-text">Ù†ÙˆØ¹ Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="{{ form.contract_amount.id_for_label }}" class="form-label fw-semibold">
                                    {{ form.contract_amount.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.contract_amount }}
                                {% if form.contract_amount.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.contract_amount.errors.0 }}
                                    </div>
                                {% endif %}
                                <div class="form-text">Ø¨Ù‡ Ø±ÛŒØ§Ù„ - Ù…Ø«Ø§Ù„: 1,500,000,000</div>
                            </div>
                            
                            <!-- Ø±Ø¯ÛŒÙ Ø´Ø´Ù…: Ú©Ø´ÙˆØ± -->
                            <div class="col-md-6">
                                <label for="{{ form.country.id_for_label }}" class="form-label fw-semibold">
                                    {{ form.country.label }}
                                </label>
                                <div class="form-floating">
                                    {{ form.country }}
                                    {% if form.country.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.country.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-text">Ú©Ø´ÙˆØ± Ù…Ø­Ù„ Ù¾Ø±ÙˆÚ˜Ù‡ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶: Ø§ÛŒØ±Ø§Ù†)</div>
                            </div>

                            <!-- Ø±Ø¯ÛŒÙ Ù‡ÙØªÙ…: Ø§Ø³ØªØ§Ù† -->
                            <div class="col-md-6">
                                <label for="{{ form.province.id_for_label }}" class="form-label fw-semibold">
                                    {{ form.province.label }} <span class="text-danger">*</span>
                                </label>
                                <div class="form-floating">
                                    {{ form.province }}
                                    {% if form.province.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.province.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-text">Ø§Ø³ØªØ§Ù† Ù…Ø­Ù„ Ø§Ø¬Ø±Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡</div>
                            </div>

                            <!-- Ø±Ø¯ÛŒÙ Ù‡Ø´ØªÙ…: Ø´Ù‡Ø± -->
                            <div class="col-md-6">
                                <label for="{{ form.city.id_for_label }}" class="form-label fw-semibold">
                                    {{ form.city.label }} <span class="text-danger">*</span>
                                </label>
                                <div class="form-floating">
                                    {{ form.city }}
                                    {% if form.city.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.city.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-text">Ø´Ù‡Ø± Ù…Ø­Ù„ Ø§Ø¬Ø±Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡</div>
                            </div>
                            
                            <!-- Ø±Ø¯ÛŒÙ Ù†Ù‡Ù…: Ø´Ù…Ø§Ø±Ù‡ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ØŒ ÙˆØ¶Ø¹ÛŒØª -->
                            
                            <div class="col-md-6">
                                <label for="{{ form.status.id_for_label }}" class="form-label fw-semibold">
                                    {{ form.status.label }}
                                </label>
                                {{ form.status }}
                                {% if form.status.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.status.errors.0 }}
                                    </div>
                                {% endif %}
                                <div class="form-text">ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡</div>
                            </div>
                            
                            <div class="col-12">
                                <div class="form-floating">
                                    <input type="text" 
                                           class="form-control {% if form.contract_number.errors %}is-invalid{% endif %}"
                                           id="{{ form.contract_number.id_for_label }}"
                                           name="{{ form.contract_number.name }}"
                                           placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯"
                                           value="{{ form.contract_number.value|default:'' }}"
                                           maxlength="50"
                                           required>
                                    <label for="{{ form.contract_number.id_for_label }}">
                                        {{ form.contract_number.label }} <span class="text-danger">*</span>
                                    </label>
                                    {% if form.contract_number.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.contract_number.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-text">Ù…Ø«Ø§Ù„: 1403/001</div>
                            </div>
                            <!-- Ø±Ø¯ÛŒÙ Ø¯Ù‡Ù…: ÙØ§ÛŒÙ„ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ -->
                            <div class="col-12">
                                <label for="{{ form.contract_file.id_for_label }}" class="form-label text-black fw-semibold">
                                    {{ form.contract_file.label }}
                                </label>
                                {{ form.contract_file }}
                                {% if form.contract_file.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.contract_file.errors.0 }}
                                    </div>
                                {% endif %}
                                <div class="form-text">
                                    ÙØ§ÛŒÙ„ PDF ÛŒØ§ Word (Ø­Ø¯Ø§Ú©Ø«Ø± 5 Ù…Ú¯Ø§Ø¨Ø§ÛŒØª) - Ø§Ø®ØªÛŒØ§Ø±ÛŒ
                                </div>
                            </div>
                            
                            <!-- Ø±Ø¯ÛŒÙ Ù†Ù‡Ù…: ØªÙˆØ¶ÛŒØ­Ø§Øª -->
                            <div class="col-12">
                                <label for="{{ form.description.id_for_label }}" class="form-label fw-semibold">
                                    {{ form.description.label }}
                                </label>
                                {{ form.description }}
                                {% if form.description.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.description.errors.0 }}
                                    </div>
                                {% endif %}
                                <div class="form-text">ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø®ØªØµØ± Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</div>
                            </div>
                        </div>
                        
                        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ -->
                        <div class="d-flex justify-content-between align-items-center mt-5 pt-3 border-top">
                            <div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="terms" required>
                                    <label class="form-check-label" for="terms">
                                        <small class="text-muted">
                                            <i class="bi bi-info-circle me-1"></i>
                                            Ø¨Ø§ <a href="#" class="text-decoration-none">Ø´Ø±Ø§ÛŒØ· Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ†</a> Ù…ÙˆØ§ÙÙ‚Ù…
                                        </small>
                                    </label>
                                </div>
                                <small class="text-muted">
                                    ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¨Ø§ Ø¹Ù„Ø§Ù…Øª * Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ù‡Ø³ØªÙ†Ø¯
                                </small>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-outline-secondary" onclick="history.back()">
                                    <i class="bi bi-arrow-right me-2"></i>Ø§Ù†ØµØ±Ø§Ù
                                </button>
                                <button type="submit" class="btn btn-success px-4" id="submitBtn">
                                    <i class="bi bi-check-circle me-2"></i>
                                    Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡
                                    <span class="spinner-border spinner-border-sm ms-2 d-none" id="submitSpinner"></span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ -->
    <div class="row justify-content-center mt-5">
        <div class="col-lg-10">
            <div class="card border-0 bg-secondary">
                <div class="card-body">
                    <h6 class="card-title mb-3">
                        <i class="bi bi-lightbulb me-2 text-warning"></i>
                        Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ ÙØ±Ù…
                    </h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="d-flex align-items-start">
                                <div class="bg-primary bg-opacity-20 text-primary rounded p-2 me-3">
                                    <i class="bi bi-hash fs-5"></i>
                                </div>
                                <div>
                                    <strong>Ú©Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡:</strong> Ø§Ø² ÙØ±Ù…Øª P-YYYY-NNN Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ 
                                    (P Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ØŒ YYYY Ø³Ø§Ù„ØŒ NNN Ø´Ù…Ø§Ø±Ù‡ ØªØ±ØªÛŒØ¨ÛŒ)
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-start">
                                <div class="bg-success bg-opacity-20 text-success rounded p-2 me-3">
                                    <i class="bi bi-calendar-check fs-5"></i>
                                </div>
                                <div>
                                    <strong>ØªØ§Ø±ÛŒØ® Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯:</strong> ØªØ§Ø±ÛŒØ® Ø§Ù…Ø¶Ø§ÛŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø¨Ù‡ Ø´Ù…Ø³ÛŒ 
                                    (Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ØŒ Ø®Ø§Ù„ÛŒ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯)
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-start">
                                <div class="bg-info bg-opacity-20 text-info rounded p-2 me-3">
                                    <i class="bi bi-currency-rial fs-5"></i>
                                </div>
                                <div>
                                    <strong>Ù…Ø¨Ù„Øº Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯:</strong> Ù…Ø¨Ù„Øº Ú©Ù„ Ø¨Ù‡ Ø±ÛŒØ§Ù„ Ø¨Ø¯ÙˆÙ† Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ 
                                    (Ù…Ø«Ø§Ù„: 1500000000)
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-start">
                                <div class="bg-warning bg-opacity-20 text-warning rounded p-2 me-3">
                                    <i class="bi bi-person-lines-fill fs-5"></i>
                                </div>
                                <div>
                                    <strong>Ú©Ø§Ø±ÙØ±Ù…Ø§:</strong> Ø§Ø² Ù„ÛŒØ³Øª Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ø¹Ø¯Ø§Ù‹ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="application/json" id="province-cities-data">
    {{ province_cities_json|safe }}
</script>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css"><link rel="stylesheet" href="https://unpkg.com/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css">

<style>
.card {
    border-radius: 12px !important;
}

.form-label {
    font-weight: 600;
    color: #495057;
}

.form-control, .form-select {
    border-radius: 8px;
    border: 1.5px solid #dee2e6;
    padding: 0.75rem 1rem;
    transition: all 0.2s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13,110,253,0.15);
    transform: translateY(-1px);
}

.is-invalid {
    border-color: #dc3545 !important;
    box-shadow: 0 0 0 0.2rem rgba(220,53,69,0.25) !important;
}

.invalid-feedback {
    color: #dc3545;
    font-size: 0.875rem;
}

.breadcrumb-light .breadcrumb-item + .breadcrumb-item::before {
    color: #6c757d;
}

.breadcrumb-light .breadcrumb-item a {
    color: #0d6efd;
    text-decoration: none;
}

.breadcrumb-light .breadcrumb-item a:hover {
    color: #ffffff;
    text-decoration: underline;
}

.btn-success {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    border: none;
}

.btn-success:hover {
    background: linear-gradient(135deg, #218838 0%, #1ea085 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(40,167,69,0.3);
}

/* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ ÙØ±Ù… */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.card {
    animation: slideInUp 0.6s ease-out;
}

/* Responsive */
@media (max-width: 768px) {
    .d-flex.justify-content-between {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch !important;
    }
    
    .d-flex.gap-2 {
        justify-content: stretch !important;
    }
    
    .btn {
        flex: 1;
        text-align: center;
    }
    
    .row.g-3 > .col-md-6,
    .row.g-3 > .col-md-8,
    .row.g-3 > .col-md-4 {
        margin-bottom: 1rem;
    }
}
</style>


{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://unpkg.com/persian-date@1.1.0/dist/persian-date.min.js"></script>
<script src="https://unpkg.com/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ Starting form initialization...');
    
    // === Persian Datepicker Initialization ===
    function initializeDatepicker() {
        const dateInput = document.querySelector('input[name="contract_date"]');
        if (!dateInput) {
            console.error('âŒ Date input not found');
            return;
        }
        
        console.log('ğŸ“… Initializing Persian Datepicker...');
        
        $(dateInput).persianDatepicker({
            format: 'YYYY/MM/DD',
            initialValue: true, // ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø±
            autoClose: true,
            position: "auto",
            calendar: {
                persian: {
                    locale: 'fa',
                    showHint: true,
                }
            },
            toolbox: {
                calendarSwitch: {
                    enabled: false
                }
            },
            navigator: {
                enabled: true,
                scroll: {
                    enabled: true
                }
            },
            timePicker: {
                enabled: false
            },
            onSelect: function(pd) {
                console.log('ğŸ“… Selected date:', pd.format('YYYY/MM/DD'));
                dateInput.value = pd.format('YYYY/MM/DD');
                dateInput.classList.remove('is-invalid');
                dateInput.classList.add('is-valid');
            },
            onShow: function() {
                console.log('ğŸ“… Datepicker shown');
            },
            onHide: function() {
                console.log('ğŸ“… Datepicker hidden');
            }
        });
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¢ÛŒÚ©ÙˆÙ† ØªÙ‚ÙˆÛŒÙ…
        const inputGroup = document.createElement('div');
        inputGroup.className = 'input-group datepicker-group';
        
        dateInput.parentNode.insertBefore(inputGroup, dateInput);
        inputGroup.appendChild(dateInput);
        
        const calendarIcon = document.createElement('span');
        calendarIcon.className = 'input-group-text bg-primary text-white cursor-pointer';
        calendarIcon.innerHTML = '<i class="bi bi-calendar3"></i>';
        calendarIcon.style.cursor = 'pointer';
        
        inputGroup.appendChild(calendarIcon);
        
        calendarIcon.addEventListener('click', function() {
            $(dateInput).persianDatepicker('show');
        });
        
        console.log('âœ… Persian Datepicker initialized');
    }

    // === Province and City Handling ===
    function initializeLocationFields() {
        const provinceSelect = document.getElementById('id_province');
        const citySelect = document.getElementById('id_city');
        const countrySelect = document.getElementById('id_country');
        
        if (!provinceSelect || !citySelect || !countrySelect) {
            console.error('âŒ Location selects not found');
            return;
        }
        
        console.log('ğŸ“ Initializing location fields...');
        
        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù‡Ø±Ù‡Ø§
        const citiesDataElement = document.getElementById('province-cities-data');
        let citiesByProvince = {};
        
        if (citiesDataElement) {
            try {
                citiesByProvince = JSON.parse(citiesDataElement.textContent);
                console.log('âœ… Cities data loaded, provinces:', Object.keys(citiesByProvince).length);
            } catch (e) {
                console.error('âŒ Error parsing cities data:', e);
                return;
            }
        }
        
        // ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ù‡Ø±Ù‡Ø§
        function updateCities() {
            const selectedProvince = provinceSelect.value;
            console.log('ğŸ”„ Updating cities for province:', selectedProvince);
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
            citySelect.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù‡Ø±</option>';
            citySelect.disabled = true;
            
            if (selectedProvince && citiesByProvince[selectedProvince]) {
                const cities = citiesByProvince[selectedProvince];
                console.log(`ğŸ“ Loading ${cities.length} cities for ${selectedProvince}`);
                
                cities.forEach(function(city) {
                    const option = document.createElement('option');
                    option.value = city[0];
                    option.textContent = city[1];
                    citySelect.appendChild(option);
                });
                
                citySelect.disabled = false;
                console.log('âœ… City select enabled');
            } else {
                console.log('âŒ No cities found for province:', selectedProvince);
            }
        }
        
        // Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± Ø§Ø³ØªØ§Ù†
        provinceSelect.addEventListener('change', function() {
            console.log('ğŸ›ï¸ Province changed to:', this.value);
            this.classList.remove('is-invalid');
            updateCities();
        });
        
        // Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± Ú©Ø´ÙˆØ±
        countrySelect.addEventListener('change', function() {
            console.log('ğŸŒ Country changed to:', this.value);
            if (this.value !== 'Ø§ÛŒØ±Ø§Ù†') {
                provinceSelect.value = '';
                citySelect.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù‡Ø±</option>';
                citySelect.disabled = true;
            } else {
                updateCities();
            }
        });
        
        // Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± Ø´Ù‡Ø±
        citySelect.addEventListener('change', function() {
            console.log('ğŸ™ï¸ City changed to:', this.value);
            this.classList.remove('is-invalid');
        });        
        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        if (countrySelect.value === 'Ø§ÛŒØ±Ø§Ù†' && provinceSelect.value) {
            updateCities();
        }
        
        console.log('âœ… Location fields initialized');
    }

    // === Form Validation ===
    function initializeFormValidation() {
        const form = document.getElementById('projectCreateForm');
        if (!form) {
            console.error('âŒ Form not found');
            return;
        }
        
        console.log('âœ… Form validation initialized');
        
        // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø³Ø§Ø¨Ù…ÛŒØª ÙØ±Ù…
        form.addEventListener('submit', function(e) {
            console.log('ğŸ“¤ Form submission started...');
            
            let isValid = true;
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§Ø³ØªØ§Ù†
            const provinceSelect = document.getElementById('id_province');
            if (!provinceSelect.value) {
                provinceSelect.classList.add('is-invalid');
                isValid = false;
                console.log('âŒ Province validation failed');
            }
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø´Ù‡Ø±
            const citySelect = document.getElementById('id_city');
            if (!citySelect.disabled && !citySelect.value) {
                citySelect.classList.add('is-invalid');
                isValid = false;
                console.log('âŒ City validation failed');
            }
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªØ§Ø±ÛŒØ®
            const dateInput = document.querySelector('input[name="contract_date"]');
            if (!dateInput.value) {
                dateInput.classList.add('is-invalid');
                isValid = false;
                console.log('âŒ Date validation failed');
            }
            
            if (!isValid) {
                e.preventDefault();
                console.log('âŒ Form validation failed');
                
                // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø§ÙˆÙ„ÛŒÙ† ÙÛŒÙ„Ø¯ Ø¯Ø§Ø±Ø§ÛŒ Ø®Ø·Ø§
                const firstError = form.querySelector('.is-invalid');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstError.focus();
                }
            } else {
                console.log('âœ… Form validation passed');
                // Ù†Ù…Ø§ÛŒØ´ Ø§Ø³Ù¾ÛŒÙ†Ø±
                const submitBtn = document.getElementById('submitBtn');
                const submitSpinner = document.getElementById('submitSpinner');
                if (submitBtn && submitSpinner) {
                    submitBtn.disabled = true;
                    submitSpinner.classList.remove('d-none');
                    submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Ø¯Ø± Ø­Ø§Ù„ Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡...';
                }
            }
        });
    }

    // === Reset Form Function ===
    window.resetForm = function() {
        if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±Ù… Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ')) {
            const form = document.getElementById('projectCreateForm');
            if (form) {
                form.reset();
                
                // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªØ§Ø±ÛŒØ® Ø¨Ù‡ Ø§Ù…Ø±ÙˆØ²
                const dateInput = document.querySelector('input[name="contract_date"]');
                if (dateInput) {
                    const today = new Date();
                    const persianDate = new persianDate(today);
                    dateInput.value = persianDate.format('YYYY/MM/DD');
                }
                
                // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª
                const provinceSelect = document.getElementById('id_province');
                const citySelect = document.getElementById('id_city');
                const countrySelect = document.getElementById('id_country');
                
                if (countrySelect) countrySelect.value = 'Ø§ÛŒØ±Ø§Ù†';
                if (provinceSelect) provinceSelect.value = '';
                if (citySelect) {
                    citySelect.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù‡Ø±</option>';
                    citySelect.disabled = true;
                }
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø®Ø·Ø§Ù‡Ø§
                document.querySelectorAll('.is-invalid').forEach(el => {
                    el.classList.remove('is-invalid');
                });
                
                console.log('âœ… Form reset completed');
            }
        }
    };

    // === Initialize Everything ===
    console.log('ğŸ¯ Starting all initializations...');
    initializeDatepicker();
    initializeLocationFields();
    initializeFormValidation();
    console.log('ğŸ‰ All initializations completed!');
});
</script>

{% endblock %}
